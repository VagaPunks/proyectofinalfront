<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Dashboard - Seguimiento Profesores</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="css/estilos.css">
</head>

<body>
    <!-- CONTROL DE SESIÓN -->
    <script>
        // Verificar si hay sesión activa mediante una llamada al servidor
        async function verificarSesion() {
            try {
                const response = await fetch('https://proyectofinal-mzx3.onrender.com/api/auth/login', {
                  method: 'GET',
                    credentials: 'include' // Asegura que las cookies se envíen
                });
                if (!response.ok) {
                    // Si no está autenticado, redirige al login
                    window.location.href = "login.html";
                }
            } catch (error) {
                console.error('Error al verificar sesión:', error);
                window.location.href = "login.html";
            }
        }

        // Llamar a la función para verificar sesión
        verificarSesion();
    </script>

    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand fw-bold" href="#">Seguimiento Profesores</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link active" href="index.html">Dashboard</a></li>
                    <li class="nav-item"><a class="nav-link" href="profesores.html">Profesores</a></li>
                    <li class="nav-item"><a class="nav-link" href="asignaturas.html">Asignaturas</a></li>
                    <li class="nav-item"><a class="nav-link" href="evaluaciones.html">Evaluaciones</a></li>
                    <li class="nav-item"><a class="nav-link" href="usuarios.html">Usuarios</a></li>
                    <li class="nav-item"><a class="nav-link" href="consulta.html">Consulta</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- CONTENIDO DASHBOARD -->
    <main class="container my-5">
        <h2 class="fw-bold mb-4"><i class="bi bi-speedometer2 me-2"></i>Panel Principal</h2>
        <div class="row g-3">
            <div class="col-md-3">
                <div class="card text-center p-2">
                    <i class="bi bi-person-lines-fill display-4 text-primary mb-2"></i>
                    <h4 id="profesores-count">Cargando...</h4>
                    <p>Profesores registrados</p>
                    <a href="profesores.html" class="btn btn-primary btn-sm">Ver lista</a>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-2">
                    <i class="bi bi-journal-text display-4 text-primary mb-2"></i>
                    <h4 id="asignaturas-count">Cargando...</h4>
                    <p>Asignaturas activas</p>
                    <a href="asignaturas.html" class="btn btn-primary btn-sm">Ver catálogo</a>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-2">
                    <i class="bi bi-clipboard-check display-4 text-primary mb-2"></i>
                    <h4 id="evaluaciones-count">Cargando...</h4>
                    <p>Evaluaciones</p>
                    <a href="evaluaciones.html" class="btn btn-primary btn-sm">Ver detalles</a>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-2">
                    <i class="bi bi-people display-4 text-primary mb-2"></i>
                    <h4 id="usuarios-count">Cargando...</h4>
                    <p>Usuarios activos</p>
                    <a href="usuarios.html" class="btn btn-primary btn-sm">Ver usuarios</a>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center p-2">
                    <i class="bi bi-eye display-4 text-primary mb-2"></i>
                    <h4 id="consultas-count">Cargando...</h4>
                    <p>Consultas realizadas</p>
                    <a href="consulta.html" class="btn btn-primary btn-sm">Ver detalles</a>
                </div>
            </div>
        </div>
    </main>

    <footer class="text-center text-white py-3 bg-primary mt-auto">
        <small>&copy; 2025 Seguimiento a Profesores. Todos los derechos reservados.</small>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Función para cargar los datos de los distintos endpoints
        async function cargarDatos() {
            try {
                const urls = [
                    "https://proyectofinal-mzx3.onrender.com/api/usuarios",
                    "https://proyectofinal-mzx3.onrender.com/api/asignaturas",
                    "https://proyectofinal-mzx3.onrender.com/api/evaluaciones",
                    "https://proyectofinal-mzx3.onrender.com/api/profesores",
                    "https://proyectofinal-mzx3.onrender.com/api/consultas"  // Nueva llamada a consultas
                ];

                const [usuarios, asignaturas, evaluaciones, profesores, consultas] = await Promise.all(urls.map(url =>
                    fetch(url, { credentials: 'include' }).then(res => res.json())
                ));

                // Asignar los valores de total a las variables
                document.getElementById('profesores-count').textContent = profesores.total;
                document.getElementById('asignaturas-count').textContent = asignaturas.total;
                document.getElementById('evaluaciones-count').textContent = evaluaciones.total;
                document.getElementById('usuarios-count').textContent = usuarios.total;
                document.getElementById('consultas-count').textContent = consultas.total;  // Mostrar el total de consultas
            } catch (error) {
                console.error('Error al cargar los datos:', error);
            }
        }

        // Cargar los datos cuando el DOM esté listo
        window.onload = cargarDatos;
    </script>
</body>

</html>
