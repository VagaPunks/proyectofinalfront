<script>
  document.addEventListener('DOMContentLoaded', () => {
    fetchProfesores();
  });

  // Obtener todos los profesores
  function fetchProfesores() {
    fetch('https://proyectofinal-mzx3.onrender.com/api/profesores')
      .then(response => response.json())
      .then(data => {
        const tableBody = document.querySelector('table tbody');
        tableBody.innerHTML = '';

        data.forEach(profesor => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${profesor._id}</td>
            <td>${profesor.nombre}</td>
            <td>${profesor.correo}</td>
            <td>${profesor.telefono}</td>
            <td><span class="badge bg-${profesor.estatus === 'Activo' ? 'success' : 'danger'}">${profesor.estatus}</span></td>
            <td>
              <button class="btn btn-sm btn-outline-primary" onclick="editarProfesor('${profesor._id}')"><i class="bi bi-pencil"></i></button>
              <button class="btn btn-sm btn-outline-danger" onclick="eliminarProfesor('${profesor._id}')"><i class="bi bi-trash"></i></button>
            </td>
          `;
          tableBody.appendChild(row);
        });
      })
      .catch(error => console.error('Error al cargar los profesores:', error));
  }

  // Editar un profesor
  function editarProfesor(id) {
    fetch(`https://proyectofinal-mzx3.onrender.com/api/profesores/${id}`)
      .then(response => response.json())
      .then(profesor => {
        // Completar el formulario con los datos del profesor
        const form = document.querySelector('#formProfesor');
        form.querySelector('input[name="nombre"]').value = profesor.nombre;
        form.querySelector('input[name="correo"]').value = profesor.correo;
        form.querySelector('input[name="telefono"]').value = profesor.telefono;
        form.querySelector('select[name="estatus"]').value = profesor.estatus;

        // Cambiar el comportamiento del formulario a actualizar
        form.onsubmit = (e) => {
          e.preventDefault();
          actualizarProfesor(id);
        };
        // Mostrar el modal
        new bootstrap.Modal(document.getElementById('modalProfesor')).show();
      })
      .catch(error => console.error('Error al cargar los datos del profesor:', error));
  }

  // Actualizar profesor
  function actualizarProfesor(id) {
    const form = document.querySelector('#formProfesor');
    const profesorData = {
      nombre: form.querySelector('input[name="nombre"]').value,
      correo: form.querySelector('input[name="correo"]').value,
      telefono: form.querySelector('input[name="telefono"]').value,
      estatus: form.querySelector('select[name="estatus"]').value,
    };

    fetch(`https://proyectofinal-mzx3.onrender.com/api/profesores/${id}`, {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(profesorData)
    })
    .then(response => response.json())
    .then(data => {
      console.log('Profesor actualizado:', data);
      fetchProfesores();  // Refrescar la lista de profesores
      document.querySelector('#modalProfesor').modal('hide');  // Cerrar el modal
    })
    .catch(error => console.error('Error al actualizar el profesor:', error));
  }

  // Eliminar un profesor
  function eliminarProfesor(id) {
    if (confirm('¿Estás seguro de que quieres eliminar este profesor?')) {
      fetch(`https://proyectofinal-mzx3.onrender.com/api/profesores/${id}`, {
        method: 'DELETE'
      })
      .then(() => {
        console.log('Profesor eliminado');
        fetchProfesores();  // Refrescar la lista de profesores
      })
      .catch(error => console.error('Error al eliminar el profesor:', error));
    }
  }

  // Agregar un nuevo profesor
  document.querySelector('#formProfesor').addEventListener('submit', (e) => {
    e.preventDefault();
    const form = e.target;
    const profesorData = {
      nombre: form.querySelector('input[name="nombre"]').value,
      correo: form.querySelector('input[name="correo"]').value,
      telefono: form.querySelector('input[name="telefono"]').value,
      estatus: form.querySelector('select[name="estatus"]').value,
    };

    fetch('https://proyectofinal-mzx3.onrender.com/api/profesores', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(profesorData)
    })
    .then(response => response.json())
    .then(data => {
      console.log('Profesor agregado:', data);
      fetchProfesores();  // Refrescar la lista de profesores
      document.querySelector('#modalProfesor').modal('hide');  // Cerrar el modal
    })
    .catch(error => console.error('Error al agregar el profesor:', error));
  });
</script>
